# Initial History

Short history related to this repo (i.e., my lame excuse for "why are your codes here so superficial and crude/messy?"):

I (@ysBach) joined the SPHEREx team in September 2023. At that time, I was only considering data reduction and future science, not the solar system object (SSO) locator.

From late 2023 to early 2024, I learned that the IPAC side wanted to rely on JPL Horizons and/or the IAU MPChecker for the SSO locator. I doubted this approach---it did not seem to work after I tested [SBIdent](https://ssd-api.jpl.nasa.gov/doc/sb_ident.html), [SBWOBS](https://ssd-api.jpl.nasa.gov/doc/sbwobs.html), [MPChecker](https://www.minorplanetcenter.net/cgi-bin/checkmp.cgi), and [IMCCE Miriade](https://ssp.imcce.fr/webservices/miriade/) for SPHEREx-like situations. Long story short: to achieve the ≈0.3-arcsec accuracy required for SPHEREx forced photometry, the total query time eventually became longer than the exposure times (≈2 min or 3,000 FITS files that scan ≈1-2 sr per 24 h, each FITS has 3.5 sq deg FoV), even after applying some tricks. With multiple complicated tricks, I could make the process as short as roughly the exposure time. Still, I think that could be a big burden to any API provider. In meetings and emails around early 2024, both API providers (JPL & MPC sides) explicitly discouraged such usage (queries too frequent with a wide FoV). I was advised by JPL SSDG to use SPICE kernels (i.e., download 1+ million BSP files from JPL Horizons) and started implementing that approach.

After that, there were two "turning points" that resulted in `skyloc` becoming an independent---and virtually the only public---package. Originally, until the Fall of 2024, the full `SPHEREx-SSO` package was a set of convenience tools for SPHEREx using SPICE (no `kete` at all), and it was intended to be made public. The first turning point was IPAC's suggestion/decision to use `kete` (Sep-Oct 2024), and the second was the decision to keep the SPHEREx Sky Simulator as a private package (Feb 2025). FYI, the launch happened in March 2025, the science survey started in May 2025, and the [SPHEREx Sky Simulator paper](https://iopscience.iop.org/article/10.3847/1538-4365/ae04cc) was submitted in the same month. The time was flying.

At SPHEREx meetings around mid–late 2024, I presented a dual approach called CLUT (Crude Look-Up Table) and PLUT (Precise LUT) to make the SSO locator reasonably fast and **rely only on the most robust tool---SPICE** (using `spiceypy`, a Python wrapper for CSPICE)---to minimize risk. File I/O was a major bottleneck for SPHEREx data storage and for the computing facility (TACC), so I worked to find not-so-fancy tricks to minimize I/O and attempted to speed up `spiceypy` function calls (note that `cyice` was not available at that time; it was version 6). That implementation was nearly complete (low quality but "working") by late 2024. In fall 2024, I was collaborating with IPAC developers to integrate this into the official pipeline. The legacy remains in `spicetools` and in partial SBDB/Horizons modules in this repo. You will see how crude they are, but again, "working," with decent speed, so I could focus on future science afterward.

But in October 2024, everything was changed (from my point of view)---I was notified by IPAC that they strongly preferred to rely entirely on `kete`, the NEO Surveyor mission tool, which had not been public until then (as I understand). It is a great tool, and I enjoy using it, but this meant that all the approaches I had prepared needed to be revisited. To be implemented into a mission, one must run extensive tests to prove validity and robustness. Most importantly, I, the one who will contribute to SSO location **and** SPHEREx SSO Catalog, should be accustomed to it. Moreover, core calculators (in our case, SPICE or kete, depending on our choice) should almost never be updated afterward to avoid any possibility of breaking changes. Also, since `kete` is not developed or owned by the SPHEREx team, we cannot ask its developers to fine-tune some parts for SPHEREx purposes. The launch was only half a year away. Then the main developer of `kete` left IPAC/NEOS team, and two diverging versions now exist. (And note: the core reason I initially chose SPICE was its semi-permanent reliability, reproducibility, and compatibility, to minimize any distraction)

Fortunately, `kete` was released under the BSD-3 license. I therefore concluded the only reasonable approach is to freeze the `kete` to the version of the IPAC account (as of early 2025) and apply many default settings as a wrapper around it. At the moment, I manually install `kete==1.x` before testing `skyloc`. The main, frozen `kete` will never be changed, while the wrapper can freely be. For example, the `fov_to_sun` option was added after several months of debugging. `FOVCollection` is included to ease handling SPHEREx-like observations (six detectors, three FoVs, identical DATE-OBS, grouped under a single ObsID). It is used in the private `SPHEREx-SSO` scripts (again a collection of messy and specific scripts only for SPHEREx data) to reduce my (stupid) repeated code lines.

Then the second complication was that, as mentioned above, in early 2025 the SPHEREx tools were decided to remain private. I therefore had to move some parts of the SSO tools (essentially the "idioms" of functions following the [DRY](https://en.wikipedia.org/wiki/Don%27t_repeat_yourself) principle) to a public repo, primarily to make them usable for SPHEREx external collaborators (the so-called XC) who have no access to other SPHEREx tools---especially the SPHEREx follow-up SSO Lightcurve Observatory, SOLO (B. Lim et al., JKAS, in prep.). The functions in `skyloc` were created to be used by the SOLO reduction pipeline, for example, and some are already in use. It will likely to be used in SNU's Pyeongchang telescope equipped with SQUIDPOL (S. Jin et al. in prep), too. All of this resulted in the creation of the `skyloc` repo as a separate one (but slightly more generalized than the original form so that it can be a bit more useful in general). That is why `skyloc` looks like nothing more than a collection of messy tools and wrappers around `kete` and SPICE.

`skyloc` has been used in these publications (note that, due to the history described above, using `skyloc` almost certainly implies using `kete` and `spiceypy`):

* [C. M. Lisse, Y. P. Bach et al. (2025) RNAAS 9, 242](https://ui.adsabs.harvard.edu/abs/2025RNAAS...9..242L/abstract)
* C. M. Lisse, Y. P. Bach et al. (2025) ApJL, to be submitted no later than Dec 2025.
* B. Lim et al. (2026) JKAS, to be submitted soon.
* S. Jin et al. (2026), in prep.
